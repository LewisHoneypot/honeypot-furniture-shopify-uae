{% comment %}
==============================================
Creation & Delivery (with Cylindo Viewer)
==============================================
{% endcomment %}

<section class="creation-delivery">
  <div class="creation-delivery__container">

    {% if section.settings.step_title != blank %}
      <h2 class="creation-delivery__step">{{ section.settings.step_title }}</h2>
    {% endif %}

    {% if section.settings.subtitle != blank %}
      <p class="creation-delivery__subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}

  {% if section.settings.model_url != blank %}
      <div class="homepage-model__viewer">
        <product-model class="deferred-media media media--transparent global-media-settings global-media-settings--no-shadow"
          style="padding-top: min(calc(100vh - 12rem), 100%)">
          <template>
            <model-viewer
              id="homepage-model-viewer"
              src="{{ section.settings.model_url }}"
              alt="3D Model"
              auto-rotate
              camera-controls
              ar
              ar-modes="webxr scene-viewer quick-look"
              style="width: 100%; height: 500px;">
            </model-viewer>
          </template>
        </product-model>

        <button
          class="button button--full-width product__xr-button"
          type="button"
          aria-label="View in your space"
          data-shopify-xr
          data-shopify-model3d-id="homepage-model-viewer"
          data-shopify-title="3D Model"
          data-shopify-xr-hidden>
          {% render 'icon-3d-model' %}
          View in your space
        </button>
      </div>
    {% else %}
      <p>Please add a model file URL from the customizer to show the 3D model.</p>
    {% endif %}

    {% if section.settings.description != blank %}
      <p class="creation-delivery__description">{{ section.settings.description }}</p>
    {% endif %}

    {% if section.settings.button_label != blank and section.settings.button_link != blank %}
      <a href="{{ section.settings.button_link }}" class="creation-delivery__btn">
        {{ section.settings.button_label }}
      </a>
    {% endif %}

  </div>
</section>

<style>
#journey-6 .creation-delivery {
  background: #fff;
  text-align: center;
  padding: 60px 0px;
}
.creation-delivery__container {
  max-width: 1000px;
  margin: 0 auto;
  text-align:center;
}
.creation-delivery__step {
  font-size: 35px;
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 10px;
}
.creation-delivery__subtitle {
  font-size: 2.5rem;
  color: #222;
  margin :0px;
}
.creation-delivery__image-wrapper {
  max-width: 100%;
  margin: 0 auto 30px;
}
.creation-delivery__image {
  width: 100%;
  height: auto;
  display: block;
  margin: 0 auto;
}
.creation-delivery__description {
  font-size: 16px;
  color: #171717;
  max-width: 600px;
  margin: 0 auto 25px;
  line-height: 1.6;
}
.creation-delivery__btn {
  display: inline-block;
  padding: 12px 28px;
  background: transparent;
  border: 1px solid #CEAD8E;
  color: #CEAD8E;
  font-size: 16px;
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  text-decoration: none;
  transition: all 0.3s ease;
}
.creation-delivery__btn:hover {
  background: #f5f5f5;
  color: #000;
  border-color: #999;
}
@media (max-width: 768px) {
  .creation-delivery__description {
    font-size: 15px;
  }
  .creation-delivery__step {
    font-size: 32px;
  }
  .creation-delivery__subtitle {
    font-size: 20px;
  }
}
</style>
<script>
if (!customElements.get('product-model')) {
  customElements.define(
    'product-model',
    class ProductModel extends DeferredMedia {
      constructor() {
        super();
      }

      loadContent() {
        super.loadContent();
        Shopify.loadFeatures([
          {
            name: 'model-viewer-ui',
            version: '1.0',
            onLoad: this.setupModelViewerUI.bind(this),
          },
        ]);
      }

      setupModelViewerUI(errors) {
        if (errors) return;
        this.modelViewerUI = new Shopify.ModelViewerUI(this.querySelector('model-viewer'));
      }
    }
  );
}

window.addEventListener('DOMContentLoaded', () => {
  if (window.ProductModel) {
    Shopify.loadFeatures([
      {
        name: 'shopify-xr',
        version: '1.0',
        onLoad() {
          if (window.ShopifyXR) window.ShopifyXR.setupXRElements();
        },
      },
    ]);
  }
});

</script>
{% schema %}
{
  "name": "Creation & Delivery (3D)",
  "settings": [
    {
      "type": "text",
      "id": "model_url",
      "label": "3D Model URL (.glb or .usdz)",
      "info": "Upload your model in Settings → Files and paste its URL here."
    },
    {
      "type": "text",
      "id": "step_title",
      "label": "Step Title",
      "default": "STEP 6"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Creation & Delivery"
    },
    {
      "type": "text",
      "id": "cylindo_sku",
      "label": "Cylindo SKU",
      "info": "Paste the Cylindo SKU here (e.g. SOFA-3SEATER-OTTOMAN)"
    },
    {
      "type": "text",
      "id": "cylindo_client",
      "label": "Cylindo Client ID",
      "info": "Paste your Cylindo client name (e.g. honeypotfurniture)"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Fallback Image"
    },
    {
      "type": "text",
      "id": "image_alt",
      "label": "Image Alt Text",
      "default": "Custom Sofa Creation & Delivery"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Once you've finalised your design and fabric choice, we handcraft your sofa to order and deliver it within 7–14 days."
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "CUSTOMISE YOUR SOFA"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "Creation & Delivery 3D",
      "category": "Custom Sections"
    }
  ]
}
{% endschema %}
