<div id="pdp-gallery" style="max-width:820px;margin:0 auto;">
  <!-- Main display -->
  <div
    id="main-image-wrapper"
    style="aspect-ratio:1/1;position:relative;touch-action:pan-y;user-select:none;-webkit-user-drag:none;cursor:grab;"
  >
    <div id="custom-gallery-controls" aria-hidden="false"></div>
  </div>

  {% assign first_word = product.title | split: ' ' | first %}

  <!-- Thumbnails -->
  <div class="thumb-carousel">
    <!-- Left chevron -->
    <button class="thumb-nav left" part="chevron-left" aria-label="Previous">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        style="transform: rotate(180deg);"
      >
        <path fill="currentColor" d="M9.01 17.45a.92.92 0 0 1-.2-.55c-.02-.2.05-.38.2-.53l4.4-4.4L9 7.55A.69.69 0 0 1 8.8 7c.01-.22.08-.4.21-.54a.7.7 0 0 1 .54-.23c.2 0 .36.08.51.23l4.98 4.98c.08.08.14.17.17.25.04.08.05.17.05.27s-.01.2-.05.28a.76.76 0 0 1-.17.25l-4.95 4.95a.68.68 0 0 1-.53.21.92.92 0 0 1-.55-.21Z"></path>
      </svg>
    </button>

    <div id="thumb-bar" style="display:flex;gap:8px;overflow-x:auto;margin-top:1rem;align-items:center;">
      <!-- Fixtuur 360 thumbnail -->
      <div class="cylindo-thumbnail-btn" data-fixtuur hidden>
        <div class="thumb-inner">
          <img
            class="thumb"
            src="https://fixtuur-honeypot.sirv.com/prod/{{ first_word }}/{{ product.variants[0].sku }}/spin/{{ product.variants[0].sku }}_0000.jpg?w=70"
            alt="360 view"
            draggable="false"
            height="48"
            width="64"
          >
        </div>
      </div>

      {% for media in product.media %}
        {% unless media.id == product.selected_or_first_available_variant.featured_media.id %}
          <div class="cylindo-thumbnail-btn">
            <div class="thumb-inner">
              <img
                class="thumb"
                data-type="shopify"
                data-src="{{ media | image_url: width: 1500 }}"
                src="{{ media | image_url: width: 150 }}"
                alt="{{ media.alt | escape }}"
                draggable="false"
                height="48"
                width="64"
              >
            </div>
          </div>
        {% endunless %}
      {% endfor %}
    </div>

    <!-- Right chevron -->
    <button class="thumb-nav right" part="chevron-right" aria-label="Next">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" d="M9.01 17.45a.92.92 0 0 1-.2-.55c-.02-.2.05-.38.2-.53l4.4-4.4L9 7.55A.69.69 0 0 1 8.8 7c.01-.22.08-.4.21-.54a.7.7 0 0 1 .54-.23c.2 0 .36.08.51.23l4.98 4.98c.08.08.14.17.17.25.04.08.05.17.05.27s-.01.2-.05.28a.76.76 0 0 1-.17.25l-4.95 4.95a.68.68 0 0 1-.53.21.92.92 0 0 1-.55-.21Z"></path>
      </svg>
    </button>
  </div>
</div>

<style>
  #thumb-bar {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    align-items: center;
  }

  .cylindo-thumbnail-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 62px;
    flex-shrink: 0;
    border-radius: 4px;
    border: 1px solid #ccc;
    padding: 4px;
    box-sizing: border-box;
    background-color: #ededed;
    overflow: hidden; /* crop tall/wide images */
    cursor: pointer;
  }

  .cylindo-thumbnail-btn img.thumb {
    height: auto; /* maintain aspect ratio */
    object-fit: cover; /* crop if aspect doesnâ€™t match */
  }

  .cylindo-thumbnail-btn img.thumb,
  .cylindo-thumbnail-btn svg.thumb {
    pointer-events: none;
    width: 100%;
    display: block;
  }

  #thumb-bar::-webkit-scrollbar {
    display: none;
  }

  .cylindo-thumbnail-btn img {
    pointer-events: none; /* let parent div capture clicks */
  }

  .thumb {
    filter: brightness(96%);
  }

  .thumb-inner {
    width: 100%;
    height: 100%;
    overflow: hidden; /* crop excess */
    border-radius: 2px; /* optional: soften inside corners */
    display: contents;
  }

  .cylindo-svg-degrees {
    font-size: 9px;
    font-family: Helvetica, Arial, sans-serif;
    font-weight: bold;
    font-size: 12px;
    dominant-baseline: middle;
    text-anchor: middle;
    fill: currentcolor;
  }

  .cylindo-svg-text {
    font-family: Helvetica, Arial, sans-serif;
    font-weight: bold;
    font-size: 12px;
    dominant-baseline: middle;
    text-anchor: middle;
    fill: currentcolor;
  }

  .thumb-inner img.thumb {
    width: 100%;
    height: 100%;
    object-fit: cover; /* crop if aspect ratio doesn't match */
    display: block;
  }

  .cylindo-thumbnail-btn.active {
    border: 1px solid #9bb0be !important; /* highlight active */
  }

  #thumb-bar::-webkit-scrollbar {
    display: none;
  }

  .thumb-carousel {
    display: flex;
    align-items: center;
    justify-content: center; /* âœ… centers the whole thumbnail bar */
    gap: 4px;
    margin-top: 1rem;
    flex-wrap: nowrap;
  }

  .thumb-nav {
    background: none;
    border: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 400ms ease;
    color: var(--scoped-chevron-color);
    background-color: transparent;
    background-position: center;
    transition: background 500ms;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    height: 100%;
    aspect-ratio: 1;
    padding-top: 14px;
  }

  .cylindo-thumbnail-btn:hover:not(.active) {
    border: 1px solid #888;
  }

  .thumb-nav:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  /* Hand teaser styling */
  #teaser-hand {
    position: absolute;
    bottom: 42%;
    left: 50%;
    width: 36px;
    height: 36px;
    transform: translateX(-50%);
    pointer-events: none; /* donâ€™t block clicks */
    opacity: 0.8;
    transition: opacity 0.3s ease;
  }
  #teaser-hand.dragging {
    opacity: 0;
    transform: translateX(-50%) scale(0.9);
  }

  #main-image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden; /* default for spin mode */
  }

  #main-image-wrapper .Fixtuur {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%; /* max width of container */
    height: auto; /* maintain aspect ratio */
    max-height: 100%; /* never overflow vertically */
  }

  #main-image-wrapper.zoomed {
    overflow: hidden; /* allow panning */
    cursor: grab; /* change cursor */
  }

  #main-image-wrapper.zoomed img {
    width: auto !important;
    height: auto !important;
    max-width: none !important;
    max-height: none !important;
  }

  #main-image-wrapper img {
    display: block;
    margin: 0 auto; /* keep centered horizontally */
  }

  #zoomBtn {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    cursor: pointer;
  }

  #zoomBtn svg {
    width: 1.2em;
    height: 1.2em;
  }

  .smv-icon-custom {
    opacity: 0.9;
    transition: opacity 0.2s ease;
    position: relative;
    margin-top: 7px;
    margin-right: 9px !important;
    float: inline-end;
  }
  .smv-icon-custom:hover {
    opacity: 1;
  }

  /* Gallery Controls */
  #custom-gallery-controls {
    position: absolute;
    top: 5px;
    right: 52px;
    display: flex;
    gap: 8px;
    z-index: 9999;
  }

  #custom-gallery-controls.not-360 {
    right: 3px;
  }

  .icon-dimensions {
    margin-top: 11px;
  }

  .not-360 .icon-dimensions {
    right: -4px;
  }

  #custom-gallery-controls .smv-icon-custom {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mainWrapper = document.getElementById('main-image-wrapper');
    const fixtuurThumb = document.querySelector('.cylindo-thumbnail-btn[data-fixtuur]');
    const thumbs = document.querySelectorAll('#thumb-bar > .cylindo-thumbnail-btn');

    // âœ… Render first Shopify image by default
    const firstShopifyThumb = document.querySelector('#thumb-bar .cylindo-thumbnail-btn:not([data-fixtuur]) img.thumb');

    if (firstShopifyThumb) {
      firstShopifyThumb.closest('.cylindo-thumbnail-btn').classList.add('active');
      showShopifyImage(firstShopifyThumb.dataset.src || firstShopifyThumb.src);
    }

    Fixtuur('getCapabilities', {
      productId: '{{ product.variants[0].sku }}',
      callback: (capabilities) => {
        if (capabilities.content) {
          console.log('Product available');

          // âœ… Show 360 thumbnail
          if (fixtuurThumb) fixtuurThumb.hidden = false;
        } else {
          console.log('Product not available');

          // âŒ Ensure 360 never loads
          fixtuurThumb?.remove();

          // âŒ Remove any accidental Fixtuur instance
          mainWrapper.querySelector('.Fixtuur')?.remove();

          // âœ… Ensure fullscreen + controls behave like non-360
          toggleFullscreenFor360();
        }
      },
    });

    function showShopifyImage(src) {
      const existingFixtuur = mainWrapper.querySelector('.Fixtuur');
      if (existingFixtuur) existingFixtuur.remove();

      const oldImg = mainWrapper.querySelector('img.main-display');
      if (oldImg) oldImg.remove();

      const img = document.createElement('img');
      img.src = src;
      img.className = 'main-display';
      img.style.width = '100%';
      img.style.height = 'auto';
      img.draggable = false;
      mainWrapper.appendChild(img);

      ensureGalleryControls();
      toggleFullscreenFor360();
    }

    function showFixtuur360() {
      const oldImg = mainWrapper.querySelector('img.main-display');
      if (oldImg) oldImg.remove();

      const existingFixtuur = mainWrapper.querySelector('.Fixtuur');
      if (existingFixtuur) existingFixtuur.remove();

      const div = document.createElement('div');
      div.className = 'Fixtuur';
      div.dataset.embed = '360';
      div.dataset.product = '{{ product.variants[0].sku }}';
      mainWrapper.appendChild(div);

      Fixtuur('refresh', { selector: '#main-image-wrapper .Fixtuur' });

      ensureGalleryControls();
      toggleFullscreenFor360();
    }

    // Handle thumbnail clicks
    thumbs.forEach((btn) => {
      btn.addEventListener('click', () => {
        if (btn.hasAttribute('data-fixtuur') && btn.hidden) return;

        thumbs.forEach((t) => t.classList.remove('active'));
        btn.classList.add('active');

        if (btn.hasAttribute('data-fixtuur')) {
          showFixtuur360();
        } else {
          const img = btn.querySelector('img.thumb');
          if (!img) return;
          showShopifyImage(img.dataset.src || img.src);
        }
      });
    });

    // Left/Right nav
    const thumbBar = document.getElementById('thumb-bar');
    const leftBtn = document.querySelector('.thumb-nav.left');
    const rightBtn = document.querySelector('.thumb-nav.right');

    function getActiveIndex() {
      const idx = Array.from(thumbs).findIndex((t) => t.classList.contains('active'));
      return idx === -1 ? 0 : idx;
    }

    function activateThumb(newIdx) {
      if (newIdx < 0) newIdx = thumbs.length - 1;
      if (newIdx >= thumbs.length) newIdx = 0;
      thumbs[newIdx].click();

      const thumb = thumbs[newIdx];
      const offset = thumb.offsetLeft - thumbBar.clientWidth / 2 + thumb.offsetWidth / 2;
      thumbBar.scrollTo({ left: offset, behavior: 'smooth' });
    }

    leftBtn.addEventListener('click', (e) => {
      e.preventDefault();
      activateThumb(getActiveIndex() - 1);
    });
    rightBtn.addEventListener('click', (e) => {
      e.preventDefault();
      activateThumb(getActiveIndex() + 1);
    });

    // âœ… INITIALISE GALLERY CONTROLS ON PAGE LOAD
    ensureGalleryControls();
    toggleFullscreenFor360();
  });
</script>

{% comment %} Fixtuur {% endcomment %}
<script>
  (function (w, d, s, o, js, fjs) {
    w[o] =
      w[o] ||
      function () {
        (w[o].q = w[o].q || []).push(arguments);
      };
    (js = d.createElement(s)), (fjs = d.getElementsByTagName(s)[0]);
    js.id = o;
    js.type = 'text/javascript';
    js.src = 'https://sdk.fixtuur.io/v1/sdk.js?clientId=' + '8ce8cb9c-06c8-4d3f-bc28-d663fd9d79ad';
    js.async = 1;
    fjs.parentNode.insertBefore(js, fjs);
  })(window, document, 'script', 'Fixtuur');

  Fixtuur('init', {
    clientId: '8ce8cb9c-06c8-4d3f-bc28-d663fd9d79ad',
    onAddToCart: function (cart) {
      // place your code here
    },
    // include language code if required
    language: 'en',
    // include region code if required
    region: 'GB',
    // opt in/out of cookies if required
    cookiePreferences: {
      performance: true,
      functional: true,
    },
  });
</script>

<script>
  function ensureGalleryControls() {
    const wrapper = document.getElementById('main-image-wrapper');
    if (!wrapper) return;

    let controls = wrapper.querySelector('#custom-gallery-controls');

    if (!controls) {
      controls = document.createElement('div');
      controls.id = 'custom-gallery-controls';
      wrapper.appendChild(controls);
    }

    // ðŸ”¹ DIMENSIONS FIRST
    if (!controls.querySelector('.icon-dimensions')) {
      const dimensions = document.createElement('div');
      dimensions.className = 'smv-icon-custom icon-dimensions';
      dimensions.innerHTML = `
      <side-drawer-opener data-side-drawer="#Drawer-drawer_nfiTCK">
        <button type="button" aria-label="Dimensions" style="all:unset">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="40" width="40" zoomAndPan="magnify" viewBox="0 0 375 374.999991" preserveAspectRatio="xMidYMid meet" version="1.0
          style="
            width: 40px;
            height: 40px;
            margin-top: 4px;
            margin-right: 10px;
            cursor: pointer;
          ">
            <defs>
              <clipPath id="255cf4331b">
                <path d="M 39.925781 18 L 335.425781 18 L 335.425781 357 L 39.925781 357 Z M 39.925781 18 " clip-rule="nonzero"></path>
              </clipPath>
              <clipPath id="60d850cd04">
                <path d="M 30.359375 7.617188 L 346.859375 7.617188 L 346.859375 367.53125 L 30.359375 367.53125 Z M 30.359375 7.617188 " clip-rule="nonzero"></path>
              </clipPath>
            </defs>
            <g clip-path="url(#255cf4331b)">
              <path fill="#a1a1a1" d="M 332.597656 100.65625 L 190.507812 19.007812 C 188.808594 17.878906 186.542969 17.878906 184.847656 19.007812 L 42.757812 100.9375 C 41.058594 102.070312 39.925781 103.765625 39.925781 105.742188 L 39.925781 269.324219 C 39.925781 271.300781 41.058594 273.277344 42.757812 274.125 L 184.847656 356.058594 C 185.695312 356.621094 186.828125 356.90625 187.675781 356.90625 C 188.527344 356.90625 189.65625 356.621094 190.507812 356.058594 L 332.597656 274.125 C 334.292969 272.996094 335.425781 271.300781 335.425781 269.324219 L 335.425781 105.460938 C 335.425781 103.480469 334.292969 101.785156 332.597656 100.65625 Z M 324.105469 265.933594 L 187.675781 344.472656 L 51.25 265.933594 L 51.25 108.851562 L 187.675781 30.308594 L 324.105469 108.851562 Z M 191.074219 69.296875 L 211.734375 84.269531 C 214.28125 85.964844 214.847656 89.636719 213.152344 92.179688 C 212.019531 93.59375 210.320312 94.441406 208.621094 94.441406 C 207.488281 94.441406 206.359375 94.160156 205.226562 93.3125 L 193.335938 84.835938 L 193.335938 184.285156 L 275.988281 239.941406 L 275.421875 225.53125 C 275.421875 222.425781 277.683594 219.882812 280.800781 219.597656 C 283.914062 219.597656 286.460938 221.859375 286.742188 224.96875 L 287.59375 250.394531 C 287.59375 250.957031 287.59375 251.523438 287.308594 251.804688 C 287.308594 251.804688 287.308594 252.089844 287.308594 252.089844 C 287.027344 252.652344 287.027344 252.9375 286.742188 253.5 C 286.460938 254.066406 286.175781 254.347656 285.609375 254.632812 C 285.609375 254.632812 285.328125 254.914062 285.328125 254.914062 C 285.042969 255.195312 284.761719 255.480469 284.195312 255.480469 C 284.195312 255.480469 283.914062 255.480469 283.914062 255.480469 L 259.855469 264.238281 C 259.289062 264.519531 258.4375 264.519531 257.871094 264.519531 C 255.609375 264.519531 253.34375 263.109375 252.496094 260.847656 C 251.363281 258.023438 252.777344 254.632812 255.890625 253.5 L 269.476562 248.417969 L 187.675781 194.171875 L 105.875 249.265625 L 119.460938 254.347656 C 122.292969 255.480469 123.992188 258.585938 122.859375 261.695312 C 122.011719 263.953125 119.746094 265.367188 117.480469 265.367188 C 116.914062 265.367188 116.066406 265.367188 115.5 265.085938 L 91.441406 256.042969 C 91.441406 256.042969 91.15625 256.042969 91.15625 256.042969 C 90.875 255.761719 90.308594 255.761719 90.027344 255.480469 C 90.027344 255.480469 89.742188 255.195312 89.742188 255.195312 C 89.460938 254.914062 88.894531 254.347656 88.609375 254.066406 C 88.328125 253.5 88.042969 253.21875 88.042969 252.652344 C 88.042969 252.652344 88.042969 252.371094 88.042969 252.371094 C 88.042969 251.804688 87.761719 251.242188 87.761719 250.960938 L 88.609375 225.53125 C 88.609375 222.425781 91.15625 219.882812 94.554688 220.164062 C 97.667969 220.164062 100.214844 222.988281 99.933594 226.097656 L 99.367188 240.503906 L 182.015625 184.285156 L 182.015625 85.117188 L 170.128906 93.59375 C 167.582031 95.289062 164.183594 94.722656 162.203125 92.179688 C 160.503906 89.636719 161.070312 86.25 163.617188 84.269531 L 184.28125 69.296875 C 184.5625 69.015625 185.128906 68.730469 185.695312 68.730469 C 185.695312 68.730469 185.980469 68.730469 185.980469 68.730469 C 186.542969 68.730469 187.109375 68.449219 187.394531 68.449219 C 187.675781 68.449219 188.527344 68.449219 188.808594 68.730469 C 188.808594 68.730469 189.09375 68.730469 189.09375 68.730469 C 189.941406 68.730469 190.507812 69.015625 191.074219 69.296875 Z M 140.125 189.085938 C 138.425781 186.542969 138.992188 182.871094 141.539062 181.175781 L 157.957031 170.15625 L 157.957031 150.378906 C 157.957031 147.273438 160.503906 144.730469 163.617188 144.730469 C 166.730469 144.730469 169.277344 147.273438 169.277344 150.378906 L 169.277344 173.265625 C 169.277344 173.546875 169.277344 174.113281 169.277344 174.394531 C 169.277344 174.679688 169.277344 174.679688 168.996094 174.960938 C 168.996094 175.242188 168.996094 175.242188 168.710938 175.523438 C 168.710938 175.808594 168.429688 175.808594 168.429688 176.089844 C 168.429688 176.371094 168.148438 176.371094 168.148438 176.65625 C 168.148438 176.9375 167.863281 176.9375 167.863281 177.21875 C 167.863281 177.21875 167.582031 177.503906 167.582031 177.503906 C 167.296875 177.785156 167.015625 178.066406 166.730469 178.351562 L 147.765625 191.0625 C 146.917969 191.628906 145.785156 191.910156 144.652344 191.910156 C 142.957031 191.628906 141.257812 190.78125 140.125 189.085938 Z M 211.734375 144.449219 C 214.847656 144.449219 217.398438 146.992188 217.398438 150.097656 L 217.398438 169.875 L 233.8125 180.894531 C 236.359375 182.589844 237.210938 186.261719 235.230469 188.804688 C 234.097656 190.5 232.398438 191.347656 230.417969 191.347656 C 229.285156 191.347656 228.152344 191.0625 227.304688 190.5 L 208.339844 177.785156 C 208.054688 177.503906 207.773438 177.21875 207.488281 176.9375 C 207.488281 176.9375 207.207031 176.65625 207.207031 176.65625 C 207.207031 176.371094 206.925781 176.371094 206.925781 176.089844 C 206.925781 175.808594 206.640625 175.808594 206.640625 175.527344 C 206.640625 175.242188 206.359375 175.242188 206.359375 174.960938 C 206.359375 174.679688 206.359375 174.679688 206.074219 174.394531 C 206.074219 174.113281 206.074219 174.113281 205.792969 173.832031 C 205.792969 173.546875 205.792969 172.984375 205.792969 172.699219 L 205.792969 149.816406 C 206.074219 146.992188 208.621094 144.449219 211.734375 144.449219 Z M 212.867188 230.335938 C 211.734375 232.3125 209.753906 233.441406 207.773438 233.441406 C 206.925781 233.441406 206.074219 233.160156 205.226562 232.878906 L 187.675781 223.554688 L 170.128906 232.878906 C 169.277344 233.441406 168.429688 233.441406 167.582031 233.441406 C 165.597656 233.441406 163.617188 232.3125 162.484375 230.335938 C 161.070312 227.507812 162.203125 224.121094 164.75 222.707031 L 184.847656 211.972656 C 185.128906 211.6875 185.414062 211.6875 185.980469 211.40625 C 186.261719 211.40625 186.261719 211.40625 186.542969 211.40625 C 186.828125 211.40625 186.828125 211.40625 187.109375 211.40625 C 187.394531 211.40625 187.394531 211.40625 187.675781 211.40625 C 187.960938 211.40625 187.960938 211.40625 188.242188 211.40625 C 188.527344 211.40625 188.808594 211.40625 188.808594 211.40625 C 188.808594 211.40625 189.09375 211.40625 189.09375 211.40625 C 189.375 211.40625 189.941406 211.6875 190.222656 211.972656 L 210.320312 222.707031 C 213.433594 224.121094 214.28125 227.792969 212.867188 230.335938 Z M 212.867188 230.335938 " fill-opacity="1" fill-rule="nonzero"></path>
            </g>
            <g clip-path="url(#60d850cd04)">
              <path fill="#a1a1a1" d="M 188.71875 20.714844 C 187.753906 20.714844 186.792969 20.964844 185.933594 21.460938 L 46.25 102.109375 C 44.535156 103.097656 43.46875 104.945312 43.46875 106.929688 L 43.46875 268.21875 C 43.46875 270.203125 44.535156 272.050781 46.25 273.042969 L 185.933594 353.6875 C 187.652344 354.679688 189.785156 354.679688 191.5 353.6875 L 331.183594 273.042969 C 332.902344 272.050781 333.96875 270.203125 333.96875 268.21875 L 333.96875 106.929688 C 333.96875 104.945312 332.902344 103.097656 331.183594 102.109375 L 191.5 21.460938 C 190.640625 20.964844 189.679688 20.714844 188.71875 20.714844 Z M 188.71875 367.53125 C 185.488281 367.53125 182.261719 366.703125 179.382812 365.039062 L 39.699219 284.390625 C 33.9375 281.066406 30.359375 274.871094 30.359375 268.21875 L 30.359375 106.929688 C 30.359375 100.277344 33.9375 94.082031 39.699219 90.757812 L 179.382812 10.113281 C 185.140625 6.785156 192.296875 6.785156 198.054688 10.113281 L 337.738281 90.757812 C 343.496094 94.082031 347.074219 100.277344 347.074219 106.929688 L 347.074219 268.21875 C 347.074219 274.871094 343.496094 281.066406 337.738281 284.394531 L 198.054688 365.039062 C 195.175781 366.703125 191.945312 367.53125 188.71875 367.53125 " fill-opacity="1" fill-rule="nonzero"></path>
            </g>
          </svg>
        </button>
      </side-drawer-opener>
    `;
      controls.appendChild(dimensions);
    }

    // ðŸ”¹ FULLSCREEN SECOND (RIGHT SIDE)
    if (!controls.querySelector('.icon-fullscreen')) {
      const fullscreen = document.createElement('div');
      fullscreen.className = 'smv-icon-custom icon-fullscreen';
      fullscreen.innerHTML = `
      <modal-opener class="product__modal-opener product__modal-opener--image d-block pos-relative w-100 no-js-hidden" data-modal="#ProductModal-template--27568632856951__main">
        <button id="pdp-zoom-toggle" class="product__media-toggle t-button b-none c-pointer d-flex p-0" type="button" aria-haspopup="dialog" data-media-id="48386929131807" style="background-color: transparent;">
          <span>
            <img 
              src="https://cdn.shopify.com/s/files/1/0857/1358/4415/files/fixtuur_fullscreen.svg?v=1767948931" 
              class="icon icon-zoom" 
              style="
                width: 36px;
                height: 36px;
                cursor: pointer;
              "
            >
          </span>
        </button>
      </modal-opener>
    `;

      controls.appendChild(fullscreen);
    }

    toggleFullscreenFor360();
  }
</script>

<script>
  function toggleFullscreenFor360() {
    const wrapper = document.getElementById('main-image-wrapper');
    if (!wrapper) return;

    const fullscreen = wrapper.querySelector('.icon-fullscreen');
    const controls = wrapper.querySelector('#custom-gallery-controls');
    if (!controls || !fullscreen) return;

    const fixtuur = wrapper.querySelector('.Fixtuur[data-embed="360"]');
    const img = wrapper.querySelector('img.main-display');
    const is360Active = !!fixtuur;

    // ðŸ§  UI state
    fullscreen.style.display = is360Active ? 'none' : '';
    controls.classList.toggle('not-360', !is360Active);

    // ðŸ” Reset click handler
    fullscreen.onclick = null;

    fullscreen.addEventListener('click', () => {
      if (is360Active && fixtuur) {
        // 360 fullscreen
        Fixtuur('fullscreen', { selector: fixtuur });
      } else if (img) {
        // Image fullscreen
        openImageFullscreen(img.src);
      }
    });
  }

  (function observe360Switching() {
    const wrapper = document.getElementById('main-image-wrapper');
    if (!wrapper) return;

    const observer = new MutationObserver(() => {
      toggleFullscreenFor360();
    });

    observer.observe(wrapper, {
      childList: true,
      subtree: true,
    });
  })();

  function openImageFullscreen(src) {
    document.querySelector('.smv-button-fullscreen-open')?.click();
  }
</script>
