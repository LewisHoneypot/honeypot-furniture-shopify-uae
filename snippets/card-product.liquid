{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1
    if card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == null
      assign ratio = 1
    endif
    capture icon_spinner
      render 'icon-spinner'
    endcapture
    capture icon_caret
      render 'icon-caret'
    endcapture

    assign image_width = image_width | default: '320, 450, 550, 750, 950, 1024, 1200, 1400, 1600, 1800, 2000'
    assign sizes = "(min-width: 361px) calc(100vw/2), calc(100vw/3)"

    assign secondary_image_class = ' card--1-image'
    assign product_img_first_classes = 'img-first motion-reduce'
    assign product_img_second_classes = 'img-second motion-reduce'

    assign product_image = card_product.featured_media | image_url: width: card_product.featured_media.width | image_tag: widths: image_width, sizes: sizes, alt: card_product.featured_media.alt, class: product_img_first_classes
    if card_product.media[1] != nil and show_secondary_image
      assign secondary_image_class = ' card--2-images'
      assign product_image_second = card_product.media[1] | image_url: width: card_product.featured_image.width | image_tag: widths: image_width, sizes: sizes, alt: card_product.title, class: product_img_second_classes
    endif

    if product_cards_style != nil
      assign product_cards_style = product_cards_style
    else
      assign product_cards_style = settings.product_cards_style
    endif
  -%}

  <div class="product-card-wrapper card-wrapper{% if card_style_popup != nil %} style-popup-{{ card_style_popup }}{% else %} style-product-{{ product_cards_style }}{% if settings.use_custom_color %} cus-bg-color{% endif %}{% endif %}{{ secondary_image_class }}{% if check_p_tab %} card--block-tab{% endif %} pos-relative h-100"
    {%- if settings.use_custom_color %}
      style="
        --cus-color-background: {{ settings.cus_card_colors_background.red }}, {{ settings.cus_card_colors_background.green }}, {{ settings.cus_card_colors_background.blue }};
      "
    {%- endif -%}
  >
    <{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %}animate-element{% else %}div{% endif %} 
      class="card{% if card_style_popup != nil %} card--standard{% else %} card--{{ product_cards_style | replace: 'standard-plus', 'standard' | replace: 'advanced-card', 'default' | replace: 'advanced-default', 'default' }}{% endif %} d-flex f-column {{ class_card }} rounded-ovh
        {%- unless check_color %} gradient gradient-global{% endunless -%}
        {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} pos-relative{% else %} h-100{% endif -%}
      "
    >
      <div class="card__inner pos-relative o-h w-100{% if card_style_popup == 'advanced-default' %} rounded-ovh{% endif %}">

        {% if section.settings.christmas_delivery_eta_toggle == true %}
          {% if section.settings.christmas_image != blank %}
            {% assign current_variant = card_product.selected_or_first_available_variant %}
            {% if current_variant.available and current_variant.inventory_quantity > 0 %}
              <div class="collection-christmas-eta">
                {{ section.settings.christmas_image | image_url: height: 150 | image_tag: loading: 'lazy' }}
              </div>
            {% endif %}
          {% endif %}
        {% endif %}

        {%- if section.settings.use_overlay_1 == true -%}
          {% assign current_variant = card_product.selected_or_first_available_variant %}
          {% if current_variant.available and current_variant.inventory_quantity > 0 %}
            <div 
              class="delivery-msg-1" 
              style="
                color: {{ section.settings.overlay_text_color_1 }}; 
                background-color: {{ section.settings.overlay_background_color_1 }};
              "
            >
              {{ section.settings.overlay_text_1 }}
            </div>
          {%- endif -%}
        {% endif %}

        {%- if section.settings.use_overlay_2 == true -%}
          {% assign current_variant = card_product.selected_or_first_available_variant %}
          {% if current_variant.available and current_variant.inventory_quantity > 0 %}
            <div class="delivery-msg-2">
              <div 
                class="text" 
                style="
                  color: {{ section.settings.overlay_text_color_2 }}; 
                  background-color: {{ section.settings.overlay_background_color_2 }};
                "
              >
                {{ section.settings.overlay_text_2 }}
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}

        <div class="card__media o-h">
          <{% if product_cards_style == 'standard' or product_cards_style == 'standard-plus' %}div{% else %}a href="{{ card_product.url }}"{% endif %}
            class="card-media media media--transparent media--{{ media_aspect_ratio }} pos-relative o-h d-block"
            {%- if media_aspect_ratio == 'adapt' %}
              style="padding-bottom: {{ 1 | divided_by: ratio | times: 100 }}%;"
            {% endif -%}
          >
            
            {%- if card_product.featured_media -%}
              
              {%- if loading == 'eager' -%}
                {{ product_image | replace: "src=", 'decoding="async" src=' }}
              {%- else -%}
                {{ product_image | replace: "src=", 'loading="lazy" decoding="async" src=' }}
              {%- endif -%}

              {{ product_image_second | replace: "src=", 'loading="lazy" decoding="async" src=' }}
            {%- else -%}
              {%- liquid
                assign index = index | default: 1
                if index > 6
                  assign index = index | modulo: 6 | plus: 1
                endif
              -%}
              {{ 'product-' | append: index | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </{% if product_cards_style == 'standard' or product_cards_style == 'standard-plus' %}div{% else %}a{% endif %}>

          {%- liquid 
            if product_cards_style == 'card' or product_cards_style == 'standard-plus' or product_cards_style == 'advanced-card' or product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default'
              assign class_discount = settings.badge_position | replace: 'top left', 'left' | replace: 'top right', 'right' | prepend: 'discounts-style-'
            endif
          -%}
          {% render 'product-discounts', product: card_product, class_discount: class_discount %}
        </div>

        {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' or product_cards_style == 'standard-plus' -%}
          <div class="card__badge pos-absolute z-index-1 d-flex f-column {{ settings.badge_position }} {{ settings.badge_transform }}"
            style="--badge-font-size: {{ settings.badge_font_size }}px;"
          >
            {%- if card_product.compare_at_price > card_product.price and card_product.available -%}
              <span
                id="Badge-{{ section_id }}-{{ card_product.id }}"
                class="badge sale-badge d-inline-block center break gradient {{ settings.badge_button_type }}"
              >
                {{- 'products.product.on_sale' | t -}}
              </span>
            {%- endif -%}
            {%- if card_product.available == false -%}
              <span
                id="Badge-{{ section_id }}-{{ card_product.id }}"
                class="badge sold-out-badge d-inline-block center break gradient {{ settings.badge_button_type }}"
              >
                {{- 'products.product.sold_out' | t -}}
              </span>
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- if product_cards_style == 'default' or product_cards_style == 'card' or product_cards_style == 'standard' or product_cards_style == 'standard-plus' or product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default' -%}
          <div class="card__wishlist effect--{{ settings.product_cards_style }} pos-absolute z-index-2 d-flex f-column {{ settings.badge_position | replace: 'top left', 'right' | replace: 'top right', 'left' }}{% if product_cards_style == 'card' %} d-none-mw-md{% endif %}">
            {%- if show_wishlist or show_wishlist_mobile -%}
              <card-wishlist class="card__function-item card__function-wishlist d-block{% unless show_wishlist_mobile %} d-none-mw-xl{% endunless %}{% unless show_wishlist %} d-none-xl{% endunless %}">
                <button class="button-wishlist wishlist-{{ settings.product_cards_style }}{% if card_button_type == 'transparent' %} button--transparent{% endif %} pos-relative c-pointer{% if settings.product_cards_style == 'standard-plus' %} b-none p-0 bg-transparent v-a-middle{% else %} b-circle{% endif %} d-inline-flex a-i-center j-c-center" type="button" aria-haspopup="dialog" aria-label="{{ 'templates.wishlist.wishlist_items' | t: count: cart.item_count }}" data-wishlist-handle="{{ card_product.handle }}">
                  {%- liquid 
                    if settings.product_cards_style == 'standard-plus'
                      assign styleIcon = 'wishlist-plus'
                    elsif settings.product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default'
                      assign styleIcon = 'wishlist-advanced-default'
                    endif
                  -%}
                  {% render 'icon-wishlist-card' 
                    style_icon: styleIcon
                  %}
                </button>
              </card-wishlist>
            {%- endif -%}
          </div>
        {%- endif -%}
        
        {%- if show_quick_add or show_swatch or show_quick_add_mobile or show_swatch_mobile -%}
          {%- unless product_cards_style == 'default' or product_cards_style == 'advanced-default' or product_cards_style == 'advanced-card' or card_style_popup == 'advanced-default' -%}
            <div class="card__quickadd quick-add no-js-hidden pos-absolute{% unless product_cards_style == 'card' or product_cards_style == 'advanced-card' %} pos-relative-ixl{% endunless %} z-index-2 w-100 bottom-0 left-0
              {%- unless product_cards_style == 'card' or product_cards_style == 'advanced-card' %}{%- if show_quick_add == false %} d-none-xl{% endif %}{% endunless -%}
              {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' %}{% if show_quick_add == false and show_swatch == false %} d-none-xl{% endif %}{% endif -%}
              {% if product_cards_style == 'card' %} d-none-mw-md{% endif %}"
            >
              {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' %}
                {%- if card_product.has_only_default_variant == false -%}
                  {%- if show_swatch or show_swatch_mobile -%}
                    {%- liquid
                      assign swatch = settings.swatch | split: ',' | strip | downcase | handle
                    -%}
                    {%- for option in card_product.options_with_values -%}
                      {%- liquid
                        assign is_swatch = false
                        assign option_name = option.name | downcase
                        if swatch contains option_name
                          assign is_swatch = true
                          assign option_size = option.values | size
                          assign variants_option_one_arr = card_product.variants | map: 'option1'
                          assign variants_option_two_arr = card_product.variants | map: 'option2'
                          assign variants_option_three_arr = card_product.variants | map: 'option3'
                        endif
                      -%}
                      {%- if is_swatch -%}
                        <div class="card__swatch d-flex f-wrap a-i-center j-c-center{% unless show_swatch_mobile %} d-none-mw-xl{% endunless %}{% unless show_swatch %} d-none-xl{% endunless %}">
                          {%- for value in option.values -%}
                            {% unless forloop.index > 4 %}
                              {%- liquid
                                assign variant_image = ''
                                for variant in card_product.variants
                                  case option.position
                                    when 1
                                      if variants_option_one_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 2
                                      if variants_option_two_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 3
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                  endcase
                                endfor
                              -%}
                              <span
                                class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                                title="{{ value }}" {% unless variant_image != blank and image_bg_url != '' %} style="--border-variant-color: {{ value | split: ' ' | last | handle }};"{% endunless %}
                              >
                                {%- if variant_image != blank -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  {%- liquid
                                    assign image_bg = value | handle | append: '.' | append: 'png'
                                    assign image_bg_url = ''
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    else
                                      assign image_bg = value | handle | append: '.' | append: 'jpg'
                                      if images[image_bg] != blank
                                        assign image_bg_url = image_bg | file_url
                                      endif
                                    endif
                                  -%}
                                  {%- if image_bg_url != '' %}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center"
                                      style="background-image: url({{ image_bg_url }})"
                                      role="none"
                                    ></span>
                                  {%- else -%}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                      style="background-color: {{ value | split: ' ' | last | handle }};"
                                      role="none"
                                    ></span>
                                  {%- endif -%}
                                {%- endif -%}
                              </span>
                            {%- endunless -%}
                          {%- endfor -%}
                          {%- if option_size > 4 -%}
                            {%- assign count = option_size | minus: 4 -%}
                            <span class="card__swatch--count color-light">
                              {{ 'products.product.more_variants' | t: count: count }}
                            </span>
                          {%- endif -%}
                        </div>
                        {% break %}
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
              {%- if show_quick_add or show_quick_add_mobile -%}
                {%- liquid
                  assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id
                  assign qty_rules = false
                  if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                    assign qty_rules = true
                  endif
                -%}
                {%- if card_product.variants.size > 1 or qty_rules -%}
                  <modal-opener data-modal="#QuickAdd-{{ card_product.id }}" class="d-block{% unless show_quick_add_mobile %} d-none-mw-xl{% endunless %}{% unless show_quick_add %} d-none-xl{% endunless %}">
                    <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                    <button
                      id="{{ product_form_id }}-submit"
                      type="submit"
                      name="add"
                      class="quick-add__submit button {{ settings.button_type | prepend: 'button--main-' }} {{ settings.button_icon | prepend: 'button--icon-' }} {{ settings.button_style | prepend: 'button--style-' }} {{ card_button_text_size | prepend: 'text-size-' }} {{ card_button_transform }} w-100{% if card_button_type == 'transparent' %} button--transparent{% endif %}"
                      aria-haspopup="dialog"
                      aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                      data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                      aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                    >
                      <span class="text d-flex a-i-center{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} j-c-center center{% else %}{% if settings.button_type == 'standard' %} center{% if settings.button_icon != 'none' %} j-c-between{% else %} j-c-center{% endif %}{% else %} j-c-between left{% endif %}{% endif %} w-100">
                        {{ 'products.product.choose_options' | t }}
                        {% if product_cards_style == 'standard' %}
                          {% render 'button-main-style' %}
                        {% endif %}
                      </span>
                      <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                    </button>
                  </modal-opener>
                  <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                    <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                      <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                        <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                      </button>
                      <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                    </div>
                  </quick-add-modal>
                {%- else -%}
                  <product-form class="d-block">
                    {%- form 'product',
                      card_product,
                      id: product_form_id,
                      class: 'form',
                      novalidate: 'novalidate',
                      data-type: 'add-to-cart-form'
                    -%}
                      <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                      <button 
                        id="{{ product_form_id }}-submit" 
                        type="submit" 
                        name="add" 
                        class="quick-add__submit button {{ settings.button_type | prepend: 'button--main-' }} {{ settings.button_icon | prepend: 'button--icon-' }} {{ settings.button_style | prepend: 'button--style-' }} {{ card_button_text_size | prepend: 'text-size-' }} {{ card_button_transform }} w-100{% if card_button_type == 'transparent' %} button--transparent{% endif %}" 
                        aria-haspopup="dialog" 
                        aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}" 
                        aria-live="polite" 
                        data-sold-out-message="true"
                        {% if card_product.selected_or_first_available_variant.available == false %} disabled{% endif %}
                      >
                        <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %}{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} j-c-center center{% else %}{% if settings.button_type == 'standard' %} center{% if settings.button_icon != 'none' %} j-c-between{% else %} j-c-center{% endif %}{% else %} j-c-between left{% endif %}{% endif %} w-100">
                          {%- if card_product.selected_or_first_available_variant.available -%}
                            {{ 'products.product.add_to_cart' | t }}
                            {% if product_cards_style == 'standard' %}
                              {% render 'button-main-style' %}
                            {% endif %}
                          {%- else -%}
                            {{ 'products.product.sold_out' | t }}
                          {%- endif -%}
                        </span>
                        <span class="sold-out-message hidden">
                          {{ 'products.product.sold_out' | t }}
                        </span>
                        <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                      </button>
                    {%- endform -%}
                  </product-form>
                {%- endif -%}
              {%- endif -%}
            </div>
          {%- endunless -%}
        {%- endif -%}

        {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' -%}
          <div class="card-function-group pos-absolute {{ settings.badge_position | replace: 'top left', 'right' | replace: 'top right', 'left' }} d-none-lg">
            <div class="card__wishlist effect--{{ settings.product_cards_style }} {{ settings.badge_position | replace: 'top left', 'right' | replace: 'top right', 'left' }}">
              {%- if show_wishlist or show_wishlist_mobile -%}
                <card-wishlist class="card__function-item card__function-wishlist d-block{% unless show_wishlist_mobile %} d-none-mw-xl{% endunless %}{% unless show_wishlist %} d-none-xl{% endunless %}">
                  <button class="button-wishlist wishlist-{{ settings.product_cards_style }}{% if card_button_type == 'transparent' %} button--transparent{% endif %} pos-relative c-pointer{% if settings.product_cards_style == 'standard-plus' %} b-none p-0 bg-transparent v-a-middle{% else %} b-circle{% endif %} d-inline-flex a-i-center j-c-center" type="button" aria-haspopup="dialog" aria-label="{{ 'templates.wishlist.wishlist_items' | t: count: cart.item_count }}" data-wishlist-handle="{{ card_product.handle }}">
                    {%- liquid 
                      if settings.product_cards_style == 'standard-plus'
                        assign styleIcon = 'wishlist-plus'
                      elsif settings.product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default'
                        assign styleIcon = 'wishlist-advanced-default'
                      endif
                    -%}
                    {% render 'icon-wishlist-card' 
                      style_icon: styleIcon
                    %}
                  </button>
                </card-wishlist>
              {%- endif -%}
            </div>
            {%- if show_quick_add_mobile -%}
              {%- liquid
                assign product_form_id = 'quick-add-mobile-' | append: section_id | append: card_product.id
                assign qty_rules = false
                if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                  assign qty_rules = true
                endif
              -%}
              {%- if card_product.variants.size > 1 or qty_rules -%}
                <modal-opener data-modal="#QuickAdd-{{ card_product.id }}-mobile" class="d-none-lg">
                  <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}-mobile" disabled>
                  <button
                    id="{{ product_form_id }}-submit"
                    type="submit"
                    name="add"
                    class="quick-add__submit button button-cart_mobile pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center link-cover"
                    aria-haspopup="dialog"
                    aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                    data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                    aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                  >
                    <span class="text d-flex a-i-center j-c-center center w-100 e-none">
                      {% if product_cards_style == 'card' %}
                        {% render 'icon-bag' %}
                      {% elsif product_cards_style == 'advanced-card' %}
                        {% render 'icon-bag', style_icon: 'advanced-card' %}
                      {% endif %}
                    </span>
                  <div class="loading-overlay__spinner z-index-2 hidden d-inline-flex pos-abolute">{{ icon_spinner }}</div>
                  </button>
                </modal-opener>
                <quick-add-modal id="QuickAdd-{{ card_product.id }}-mobile" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                  <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                    <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                      <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                    </button>
                    <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                  </div>
                </quick-add-modal>
              {%- else -%}
                <product-form class="d-none-xl">
                  {%- form 'product',
                    card_product,
                    id: product_form_id,
                    class: 'form',
                    novalidate: 'novalidate',
                    data-type: 'add-to-cart-form'
                  -%}
                    <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                    <button
                      id="{{ product_form_id }}-submit"
                      type="submit"
                      name="add"
                      class="quick-add__submit button button-cart_mobile pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center"
                      aria-haspopup="dialog"
                      aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                      aria-live="polite"
                      data-sold-out-message="true"
                      {% if card_product.selected_or_first_available_variant.available == false %}
                        disabled
                      {% endif %}
                    >
                      <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %}{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} j-c-center center{% else %} j-c-between left{% endif %} w-100 e-none">
                        {% if product_cards_style == 'card' %}
                          {% render 'icon-bag' %}
                        {% elsif product_cards_style == 'advanced-card' %}
                          {% render 'icon-bag', style_icon: 'advanced-card' %}
                        {% endif %}
                      </span>
                      <span class="sold-out-message hidden">
                        {{ 'products.product.sold_out' | t }}
                      </span>
                      <div class="loading-overlay__spinner z-index-2 hidden{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} d-inline-flex pos-abolute{% else %} d-inline-block{% endif %}">{{ icon_spinner }}</div>
                    </button>
                  {%- endform -%}
                </product-form>
              {%- endif -%}
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>

      {% comment %} Dimensions {% endcomment %}
      {%- if section.settings.collection_dimensions_toggle == true -%}
        {%- if card_product.metafields.Dimensions.TotalLength -%}
          <div class="collection-dimensions {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
            {% comment %} <span class="arrow left-arrow"></span> {% endcomment %}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="20"
              zoomAndPan="magnify"
              viewBox="0 0 375 374.999991"
              height="20"
              preserveAspectRatio="xMidYMid meet"
              version="1.0"
              style="margin-right:5px;"
            >
              <defs><clipPath id="255cf4331b"><path d="M 39.925781 18 L 335.425781 18 L 335.425781 357 L 39.925781 357 Z M 39.925781 18 " clip-rule="nonzero"/></clipPath><clipPath id="60d850cd04"><path d="M 30.359375 7.617188 L 346.859375 7.617188 L 346.859375 367.53125 L 30.359375 367.53125 Z M 30.359375 7.617188 " clip-rule="nonzero"/></clipPath></defs><rect x="-37.5" width="450" fill="#ffffff" y="-37.499999" height="449.999989" fill-opacity="1"/><rect x="-37.5" width="450" fill="#ffffff" y="-37.499999" height="449.999989" fill-opacity="1"/><g clip-path="url(#255cf4331b)"><path fill="#000000" d="M 332.597656 100.65625 L 190.507812 19.007812 C 188.808594 17.878906 186.542969 17.878906 184.847656 19.007812 L 42.757812 100.9375 C 41.058594 102.070312 39.925781 103.765625 39.925781 105.742188 L 39.925781 269.324219 C 39.925781 271.300781 41.058594 273.277344 42.757812 274.125 L 184.847656 356.058594 C 185.695312 356.621094 186.828125 356.90625 187.675781 356.90625 C 188.527344 356.90625 189.65625 356.621094 190.507812 356.058594 L 332.597656 274.125 C 334.292969 272.996094 335.425781 271.300781 335.425781 269.324219 L 335.425781 105.460938 C 335.425781 103.480469 334.292969 101.785156 332.597656 100.65625 Z M 324.105469 265.933594 L 187.675781 344.472656 L 51.25 265.933594 L 51.25 108.851562 L 187.675781 30.308594 L 324.105469 108.851562 Z M 191.074219 69.296875 L 211.734375 84.269531 C 214.28125 85.964844 214.847656 89.636719 213.152344 92.179688 C 212.019531 93.59375 210.320312 94.441406 208.621094 94.441406 C 207.488281 94.441406 206.359375 94.160156 205.226562 93.3125 L 193.335938 84.835938 L 193.335938 184.285156 L 275.988281 239.941406 L 275.421875 225.53125 C 275.421875 222.425781 277.683594 219.882812 280.800781 219.597656 C 283.914062 219.597656 286.460938 221.859375 286.742188 224.96875 L 287.59375 250.394531 C 287.59375 250.957031 287.59375 251.523438 287.308594 251.804688 C 287.308594 251.804688 287.308594 252.089844 287.308594 252.089844 C 287.027344 252.652344 287.027344 252.9375 286.742188 253.5 C 286.460938 254.066406 286.175781 254.347656 285.609375 254.632812 C 285.609375 254.632812 285.328125 254.914062 285.328125 254.914062 C 285.042969 255.195312 284.761719 255.480469 284.195312 255.480469 C 284.195312 255.480469 283.914062 255.480469 283.914062 255.480469 L 259.855469 264.238281 C 259.289062 264.519531 258.4375 264.519531 257.871094 264.519531 C 255.609375 264.519531 253.34375 263.109375 252.496094 260.847656 C 251.363281 258.023438 252.777344 254.632812 255.890625 253.5 L 269.476562 248.417969 L 187.675781 194.171875 L 105.875 249.265625 L 119.460938 254.347656 C 122.292969 255.480469 123.992188 258.585938 122.859375 261.695312 C 122.011719 263.953125 119.746094 265.367188 117.480469 265.367188 C 116.914062 265.367188 116.066406 265.367188 115.5 265.085938 L 91.441406 256.042969 C 91.441406 256.042969 91.15625 256.042969 91.15625 256.042969 C 90.875 255.761719 90.308594 255.761719 90.027344 255.480469 C 90.027344 255.480469 89.742188 255.195312 89.742188 255.195312 C 89.460938 254.914062 88.894531 254.347656 88.609375 254.066406 C 88.328125 253.5 88.042969 253.21875 88.042969 252.652344 C 88.042969 252.652344 88.042969 252.371094 88.042969 252.371094 C 88.042969 251.804688 87.761719 251.242188 87.761719 250.960938 L 88.609375 225.53125 C 88.609375 222.425781 91.15625 219.882812 94.554688 220.164062 C 97.667969 220.164062 100.214844 222.988281 99.933594 226.097656 L 99.367188 240.503906 L 182.015625 184.285156 L 182.015625 85.117188 L 170.128906 93.59375 C 167.582031 95.289062 164.183594 94.722656 162.203125 92.179688 C 160.503906 89.636719 161.070312 86.25 163.617188 84.269531 L 184.28125 69.296875 C 184.5625 69.015625 185.128906 68.730469 185.695312 68.730469 C 185.695312 68.730469 185.980469 68.730469 185.980469 68.730469 C 186.542969 68.730469 187.109375 68.449219 187.394531 68.449219 C 187.675781 68.449219 188.527344 68.449219 188.808594 68.730469 C 188.808594 68.730469 189.09375 68.730469 189.09375 68.730469 C 189.941406 68.730469 190.507812 69.015625 191.074219 69.296875 Z M 140.125 189.085938 C 138.425781 186.542969 138.992188 182.871094 141.539062 181.175781 L 157.957031 170.15625 L 157.957031 150.378906 C 157.957031 147.273438 160.503906 144.730469 163.617188 144.730469 C 166.730469 144.730469 169.277344 147.273438 169.277344 150.378906 L 169.277344 173.265625 C 169.277344 173.546875 169.277344 174.113281 169.277344 174.394531 C 169.277344 174.679688 169.277344 174.679688 168.996094 174.960938 C 168.996094 175.242188 168.996094 175.242188 168.710938 175.523438 C 168.710938 175.808594 168.429688 175.808594 168.429688 176.089844 C 168.429688 176.371094 168.148438 176.371094 168.148438 176.65625 C 168.148438 176.9375 167.863281 176.9375 167.863281 177.21875 C 167.863281 177.21875 167.582031 177.503906 167.582031 177.503906 C 167.296875 177.785156 167.015625 178.066406 166.730469 178.351562 L 147.765625 191.0625 C 146.917969 191.628906 145.785156 191.910156 144.652344 191.910156 C 142.957031 191.628906 141.257812 190.78125 140.125 189.085938 Z M 211.734375 144.449219 C 214.847656 144.449219 217.398438 146.992188 217.398438 150.097656 L 217.398438 169.875 L 233.8125 180.894531 C 236.359375 182.589844 237.210938 186.261719 235.230469 188.804688 C 234.097656 190.5 232.398438 191.347656 230.417969 191.347656 C 229.285156 191.347656 228.152344 191.0625 227.304688 190.5 L 208.339844 177.785156 C 208.054688 177.503906 207.773438 177.21875 207.488281 176.9375 C 207.488281 176.9375 207.207031 176.65625 207.207031 176.65625 C 207.207031 176.371094 206.925781 176.371094 206.925781 176.089844 C 206.925781 175.808594 206.640625 175.808594 206.640625 175.527344 C 206.640625 175.242188 206.359375 175.242188 206.359375 174.960938 C 206.359375 174.679688 206.359375 174.679688 206.074219 174.394531 C 206.074219 174.113281 206.074219 174.113281 205.792969 173.832031 C 205.792969 173.546875 205.792969 172.984375 205.792969 172.699219 L 205.792969 149.816406 C 206.074219 146.992188 208.621094 144.449219 211.734375 144.449219 Z M 212.867188 230.335938 C 211.734375 232.3125 209.753906 233.441406 207.773438 233.441406 C 206.925781 233.441406 206.074219 233.160156 205.226562 232.878906 L 187.675781 223.554688 L 170.128906 232.878906 C 169.277344 233.441406 168.429688 233.441406 167.582031 233.441406 C 165.597656 233.441406 163.617188 232.3125 162.484375 230.335938 C 161.070312 227.507812 162.203125 224.121094 164.75 222.707031 L 184.847656 211.972656 C 185.128906 211.6875 185.414062 211.6875 185.980469 211.40625 C 186.261719 211.40625 186.261719 211.40625 186.542969 211.40625 C 186.828125 211.40625 186.828125 211.40625 187.109375 211.40625 C 187.394531 211.40625 187.394531 211.40625 187.675781 211.40625 C 187.960938 211.40625 187.960938 211.40625 188.242188 211.40625 C 188.527344 211.40625 188.808594 211.40625 188.808594 211.40625 C 188.808594 211.40625 189.09375 211.40625 189.09375 211.40625 C 189.375 211.40625 189.941406 211.6875 190.222656 211.972656 L 210.320312 222.707031 C 213.433594 224.121094 214.28125 227.792969 212.867188 230.335938 Z M 212.867188 230.335938 " fill-opacity="1" fill-rule="nonzero"/></g><g clip-path="url(#60d850cd04)"><path fill="#000000" d="M 188.71875 20.714844 C 187.753906 20.714844 186.792969 20.964844 185.933594 21.460938 L 46.25 102.109375 C 44.535156 103.097656 43.46875 104.945312 43.46875 106.929688 L 43.46875 268.21875 C 43.46875 270.203125 44.535156 272.050781 46.25 273.042969 L 185.933594 353.6875 C 187.652344 354.679688 189.785156 354.679688 191.5 353.6875 L 331.183594 273.042969 C 332.902344 272.050781 333.96875 270.203125 333.96875 268.21875 L 333.96875 106.929688 C 333.96875 104.945312 332.902344 103.097656 331.183594 102.109375 L 191.5 21.460938 C 190.640625 20.964844 189.679688 20.714844 188.71875 20.714844 Z M 188.71875 367.53125 C 185.488281 367.53125 182.261719 366.703125 179.382812 365.039062 L 39.699219 284.390625 C 33.9375 281.066406 30.359375 274.871094 30.359375 268.21875 L 30.359375 106.929688 C 30.359375 100.277344 33.9375 94.082031 39.699219 90.757812 L 179.382812 10.113281 C 185.140625 6.785156 192.296875 6.785156 198.054688 10.113281 L 337.738281 90.757812 C 343.496094 94.082031 347.074219 100.277344 347.074219 106.929688 L 347.074219 268.21875 C 347.074219 274.871094 343.496094 281.066406 337.738281 284.394531 L 198.054688 365.039062 C 195.175781 366.703125 191.945312 367.53125 188.71875 367.53125 " fill-opacity="1" fill-rule="nonzero"/></g>
            </svg>
            <span>{{ card_product.metafields.Dimensions.TotalLength }}</span>
            {% comment %} <span class="arrow right-arrow"></span> {% endcomment %}
          </div>
        {%- endif -%}
      {%- endif -%}

      {% comment %} Colour Swatches {% endcomment %}
      {%- if card_product.metafields.custom.product_colour_list != blank -%}
        <div
          class="product__variant {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}"
          style="padding-top: 0px;"
          {{ block.shopify_attributes }}
        >
          <div class="color-list" style="display: inline-flex !important;">
            {% for p in card_product.metafields.custom.product_colour_list.value %}
              {% if p.metafields.custom.color_2.value %}
                <!-- Two colors with a diagonal split -->
                <div
                  class="color-item"
                  style="
                    background: linear-gradient(
                      to bottom right,
                      {{ p.metafields.custom.color.value }} 50%,
                      {{ p.metafields.custom.color_2.value }} 50%
                    );
                     height: 3.5rem; width: 3.5rem; margin-right: 5px; margin-top: 15px;
                  "
                ></div>
              {% else %}
                <!-- Only one color -->
                <div
                  class="color-item"
                  style="background-color: {{ p.metafields.custom.color.value }}; height: 3.5rem; width: 3.5rem; margin-right: 5px; margin-top: 15px;"
                ></div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {%- endif -%}              
      
      <div class="card__content w-100{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} pos-absolute top-0 left-0 h-100 e-none{% else %} d-grid{% endif %}{% unless show_swatch_mobile %} hide-q-add-mobile{% endunless %}">
        <div class="card__information{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} h-100{% if product_cards_style == 'advanced-card' %} d-grid f-row j-c-between a-i-end{% else %} d-flex f-column{% endif %}{% endif %}"
          {%- if settings.use_custom_color %}
            style="--color-background: {{ settings.cus_card_colors_background.red }}, {{ settings.cus_card_colors_background.green }}, {{ settings.cus_card_colors_background.blue }};"
          {%- endif -%}
        >
          {%- if product_cards_style == 'advanced-card' -%}
            <div class="card__vendor-w-heading e-auto pos-relative">
          {%- endif -%}
            {%- if product_cards_style != 'advanced-default' -%}
              {%- if card_style_popup != 'advanced-default' -%}
                {%- if show_vendor or show_vendor_mobile -%}
                  <div class="card__vendor subrte{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} uppercase{% else %} f-bold{% endif %}{% unless show_vendor_mobile %} d-none-mw-xl{% endunless %}{% unless show_vendor %} d-none-xl{% endunless %}"{% if product_cards_style == 'card' %} data-animate="fade-down" style="--a-delay: 0.05s;"{% endif %}{% if product_cards_style == 'advanced-card' %} data-animate="fade-up" style="--a-delay: 0.2s;"{% endif %}>
                    <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
                    {{ card_product.vendor }}
                  </div>
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
            <h3 class="card__heading m-0" id="title-{{ section_id }}-{{ card_product.id }}"{% if product_cards_style == 'card' %} data-animate="fade-down" style="--a-delay: 0.1s;"{% endif %}{% if product_cards_style == 'advanced-card' %} data-animate="fade-up" style="--a-delay: 0.15s;"{% endif %}>
              <a 
                href="{{ card_product.url }}" 
                id="CardLink-{{ section_id }}-{{ card_product.id }}" 
                class="full-unstyled-link d-block u-none color-current link-cover{% if product_cards_style == "default" %} pos-relative{% endif %}" 
                aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }}"
              >
                {{ card_product.title | escape }}
              </a>
            </h3>
            {%- if product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default' -%}
              {%- if show_vendor or show_vendor_mobile -%}
                <div class="card__vendor subrte uppercase{% unless show_vendor_mobile %} d-none-mw-xl{% endunless %}{% unless show_vendor %} d-none-xl{% endunless %}">
                  <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
                  {{ card_product.vendor }}
                </div>
              {%- endif -%}
            {%- endif -%}
            {%- if product_cards_style == 'advanced-card' -%}
              {%- if show_swatch or show_swatch_mobile -%}
                {%- if card_product.has_only_default_variant == false -%}
                  {%- if show_swatch or show_swatch_mobile -%}
                    {%- liquid
                      assign swatch = settings.swatch | split: ',' | strip | downcase | handle
                    -%}
                    {%- for option in card_product.options_with_values -%}
                      {%- liquid
                        assign is_swatch = false
                        assign option_name = option.name | downcase
                        if swatch contains option_name
                          assign is_swatch = true
                          assign option_size = option.values | size
                          assign variants_option_one_arr = card_product.variants | map: 'option1'
                          assign variants_option_two_arr = card_product.variants | map: 'option2'
                          assign variants_option_three_arr = card_product.variants | map: 'option3'
                        endif
                      -%}
                      {%- if is_swatch -%}
                        <div class="card__swatch d-flex f-wrap a-i-center j-c-start d-none-mw-md{% unless show_swatch_mobile %} d-none-mw-xl{% endunless %}{% unless show_swatch %} d-none-xl{% endunless %}">
                          {%- for value in option.values -%}
                            {% unless forloop.index > 4 %}
                              {%- liquid
                                assign variant_image = ''
                                for variant in card_product.variants
                                  case option.position
                                    when 1
                                      if variants_option_one_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 2
                                      if variants_option_two_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 3
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                  endcase
                                endfor
                              -%}
                              <span
                                class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                                title="{{ value }}"
                                data-animate="fade-up" style="--a-delay: {{ '0.1' | times: forloop.index }}s;{% unless variant_image != blank and image_bg_url != '' %}--border-variant-color: {{ value | split: ' ' | last | handle }};{% endunless %}"
                              >
                                {%- if variant_image != blank -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  {%- liquid
                                    assign image_bg = value | handle | append: '.' | append: 'png'
                                    assign image_bg_url = ''
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    else
                                      assign image_bg = value | handle | append: '.' | append: 'jpg'
                                      if images[image_bg] != blank
                                        assign image_bg_url = image_bg | file_url
                                      endif
                                    endif
                                  -%}
                                  {%- if image_bg_url != '' %}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center"
                                      style="background-image: url({{ image_bg_url }})"
                                      role="none"
                                    ></span>
                                  {%- else -%}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                      style="background-color: {{ value | split: ' ' | last | handle }};"
                                      role="none"
                                    ></span>
                                  {%- endif -%}
                                {%- endif -%}
                              </span>
                            {%- endunless -%}
                          {%- endfor -%}
                          {%- if option_size > 4 -%}
                            {%- assign count = option_size | minus: 4 -%}
                            <span class="card__swatch--count color-light"
                              data-animate="fade-up" style="--a-delay: 0.5s;"
                            >
                              {{ 'products.product.more_variants' | t: count: count }}
                            </span>
                          {%- endif -%}
                        </div>
                        {% break %}
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- if product_cards_style == 'advanced-card' -%}
            </div>
          {%- endif -%}

          {%- if product_cards_style == 'card' -%}
            <div class="card__badge d-flex a-i-center f-wrap {{ settings.badge_transform }} d-none-mw-md" 
              data-animate="fade-down" 
              style="--a-delay: 0.15s;--badge-font-size: {{ settings.badge_font_size }}px;"
            >
              {%- if card_product.compare_at_price > card_product.price and card_product.available -%}
                <span id="Badge-{{ section_id }}-{{ card_product.id }}" aria-labelledby="Badge-{{ section_id }}-{{ card_product.id }}"
                  class="badge sale-badge break gradient d-inline-flex a-i-center j-c-center {{ settings.badge_button_type }}">
                  {{ 'products.product.on_sale' | t }}
                </span>
              {%- endif -%}
              {%- if card_product.available == false -%}
                <span id="Badge-{{ section_id }}-{{ card_product.id }}" 
                  class="badge sold-out-badge break gradient d-inline-flex a-i-center j-c-center {{ settings.badge_button_type }}">
                  {{ 'products.product.sold_out' | t }}
                </span>
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' -%}
            <div class="card__rating-w-price d-flex a-i-end{% if product_cards_style == 'advanced-card' %} f-column h-100{% if settings.badge_position == 'top right' %} j-c-end{% else %} j-c-between{% endif %}{% else %} j-c-between m-t e-auto{% endif %}" data-animate="fade-down"{% if product_cards_style == 'card' %} style="--a-delay: 0.1s; --m-t: auto"{% endif %}>
          {%- endif -%}
            {%- if product_cards_style == 'advanced-card' -%}
              <div class="card__function e-auto function--badge-{{ settings.badge_position | replace: 'top left', 'left' | replace: 'top right', 'right' }} d-none-mw-md">
                {%- if show_wishlist or show_wishlist_mobile -%}
                  <card-wishlist class="card__function-item card__function-wishlist d-block{% unless show_wishlist_mobile %} d-none-mw-xl{% endunless %}{% unless show_wishlist %} d-none-xl{% endunless %}">
                    <button class="button-wishlist wishlist-{{ settings.product_cards_style }}{% if card_button_type == 'transparent' %} button--transparent{% endif %} pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center" type="button" aria-haspopup="dialog" aria-label="{{ 'templates.wishlist.wishlist_items' | t: count: cart.item_count }}" data-wishlist-handle="{{ card_product.handle }}">
                      {%- liquid 
                        if settings.product_cards_style == 'standard-plus'
                          assign styleIcon = 'wishlist-plus'
                        elsif settings.product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default'
                          assign styleIcon = 'wishlist-advanced-default'
                        endif
                      -%}
                      {% render 'icon-wishlist-card' 
                        style_icon: styleIcon
                      %}
                    </button>
                  </card-wishlist>
                {%- endif -%}
                {%- if show_quick_add or show_quick_add_mobile -%}
                  {%- liquid
                    assign product_form_id = 'quick-add-advanced-' | append: section_id | append: card_product.id
                    assign qty_rules = false
                    if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                      assign qty_rules = true
                    endif
                  -%}
                  <div class="card__function-item card__function-cart">
                    {%- if card_product.variants.size > 1 or qty_rules -%}
                      <modal-opener data-modal="#QuickAdd-{{ card_product.id }}" class="d-block{% unless show_quick_add_mobile %} d-none-mw-xl{% endunless %}{% unless show_quick_add %} d-none-xl{% endunless %}">
                        <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                        <button
                          id="{{ product_form_id }}-submit"
                          type="submit"
                          name="add"
                          class="quick-add__submit button-advanced-card pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center"
                          aria-haspopup="dialog"
                          aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                          data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                          aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                        >
                          <span class="text d-flex a-i-center j-c-center center w-100">
                            {% render 'icon-bag', style_icon: 'advanced-card' %}
                          </span>
                          <div class="loading-overlay__spinner z-index-2 hidden d-inline-flex pos-abolute">{{ icon_spinner }}</div>
                        </button>
                      </modal-opener>
                      <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                        <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                          <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                            <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                          </button>
                          <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                        </div>
                      </quick-add-modal>
                    {%- else -%}
                      <product-form class="d-block">
                        {%- form 'product',
                          card_product,
                          id: product_form_id,
                          class: 'form',
                          novalidate: 'novalidate',
                          data-type: 'add-to-cart-form'
                        -%}
                          <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                          <button
                            id="{{ product_form_id }}-submit"
                            type="submit"
                            name="add"
                            class="quick-add__submit button-advanced-card pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center"
                            aria-haspopup="dialog"
                            aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                            aria-live="polite"
                            data-sold-out-message="true"
                            aria-label="{{ 'templates.cart.cart_items' | t: count: 1 }}"
                            {% if card_product.selected_or_first_available_variant.available == false %}
                              disabled
                            {% endif %}
                          >
                            <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %}{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} j-c-center center{% else %} j-c-between left{% endif %} w-100">
                              {% render 'icon-bag', style_icon: 'advanced-card' %}
                            </span>
                            <span class="sold-out-message hidden">
                              {{ 'products.product.sold_out' | t }}
                            </span>
                            <div class="loading-overlay__spinner z-index-2 hidden{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} d-inline-flex pos-abolute{% else %} d-inline-block{% endif %}">{{ icon_spinner }}</div>
                          </button>
                        {%- endform -%}
                      </product-form>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </div>
            {%- endif -%}
            {%- if product_cards_style == 'advanced-card' -%}
              <div class="card__advanced-rating-price e-auto">
            {%- endif -%}
              {%- if show_rating or show_rating_mobile -%}
                {%- if card_product.metafields.reviews.rating.value != blank -%}
                  {%- liquid
                    assign rating_decimal = 0
                    assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
                    if decimal >= 0.3 and decimal <= 0.7
                      assign rating_decimal = 0.5
                    elsif decimal > 0.7
                      assign rating_decimal = 1
                    endif
                  -%}
                  <div class="card__rating{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} d-flex f-shrink a-i-center{% if product_cards_style == 'advanced-card' %} j-c-end{% endif %}{% endif %}{% if product_cards_style == 'standard-plus' %} d-flex a-i-center j-c-start c-gap m-0{% endif %}{% unless show_rating_mobile %} d-none-mw-xl{% endunless %}{% unless show_rating %} d-none-xl{% endunless %}"
                    {% if product_cards_style == 'standard-plus' %}style="--c-gap: 0.5rem;"{% endif %}
                  >
                    <div
                      class="rating{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} d-inline-block{% else %} d-inline-flex{% endif %}"
                      role="img"
                      aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}"
                    >
                      <span aria-hidden="true" class="rating-star d-inline-block l-h-1"
                        style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                      ></span>
                    </div>
                    <p class="rating-text d-none caption m-0">
                      <span aria-hidden="true">
                        {{- card_product.metafields.reviews.rating.value }} /
                        {{ card_product.metafields.reviews.rating.value.scale_max -}}
                      </span>
                    </p>
                    {%- if product_cards_style != 'standard-plus' -%}
                      <p class="rating-count d-inline-block caption m-0">
                        <span aria-hidden="true">({{- card_product.metafields.reviews.rating_count -}})</span>
                        <span class="visually-hidden">
                          {{- card_product.metafields.reviews.rating_count }}
                          {{ 'accessibility.total_reviews' | t -}}
                        </span>
                      </p>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              {%- endif -%}
              {%- if product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default' -%}
                <div class="advanced__default-price-cart d-flex a-i-center j-c-between c-gap break" style="--c-gap: 0.5rem;">
              {%- endif -%}
                <div class="card__price{% if product_cards_style == 'card' %} m-l{% endif %}{% if product_cards_style == 'advanced-card' %} right{% endif %}"{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} style="--color-default-price: 0,0,0; --m-l:auto;"{% endif %}>
                  {% render 'price', product: card_product, price_class: '' %}
                </div>

                {% comment %} Delivery ETAs {% endcomment %}                 
                {%- if section.settings.collection_delivery_eta_toggle == true -%}
                  {% comment %} Check if in stock {% endcomment %}
                  {% assign current_variant = card_product.selected_or_first_available_variant %}
                  {% if current_variant.available and current_variant.inventory_quantity > 0 %}
                    {%- assign in_stock = true -%}
                  {% else %}
                    {%- assign in_stock = false -%}
                  {% endif %}
                  {% comment %} Check which collections product is in {% endcomment %}
                  {%- assign collection_titles = '' -%}
                  {%- for collection in card_product.collections -%}
                    {%- assign collection_titles = collection_titles | append: collection.title -%}
                    {%- unless forloop.last -%}
                      {%- assign collection_titles = collection_titles | append: ', ' -%}
                    {%- endunless -%}
                  {%- endfor -%}

                  {%- assign date_1 = 0 -%}
                  {%- assign date_2 = 0 -%}

                  {%- if collection_titles contains 'Sofas' -%}
                    {%- if section.settings.tiers == 'on' -%}
                      {%- if card_product.metafields.Details.ProductTier == 1 -%}
                        {%- if card_product.available and in_stock == true -%}
                          {%- assign date_1 = 1 -%}
                          {%- assign date_2 = 7 -%}
                        {%- else -%}
                          {%- assign date_1 = 7 -%}
                          {%- assign date_2 = 42 -%}
                        {%- endif -%}
                      {%- elsif card_product.metafields.Details.ProductTier == 2 -%}
                        {%- if card_product.available and in_stock == true -%}
                          {%- assign date_1 = 1 -%}
                          {%- assign date_2 = 7 -%}
                        {%- else -%}
                          {%- assign date_1 = 42 -%}
                          {%- assign date_2 = 84 -%}
                        {%- endif -%}
                      {%- endif -%}
                    {%- else -%}
                      {%- if card_product.available and in_stock == true -%}
                        {%- assign date_1 = 1 -%}
                        {%- assign date_2 = 7 -%}
                      {%- else -%}
                        {%- assign date_1 = 28 -%}
                        {%- assign date_2 = 42 -%}
                      {%- endif -%}
                    {%- endif -%}
                  {%- elsif collection_titles contains 'rugs' 
                    or card_product.tags contains 'LL'
                    or card_product.tags contains 'JB' 
                  -%}
                    {%- if card_product.available and in_stock == true -%}
                      {%- assign date_1 = 1 -%}
                      {%- assign date_2 = 7 -%}
                    {%- else -%}
                      {%- assign date_1 = 7 -%}
                      {%- assign date_2 = 10 -%}
                    {%- endif -%}
                  {%- elsif card_product.tags contains 'SD' -%}
                    {%- assign date_1 = 7 -%}
                    {%- assign date_2 = 21 -%}
                  {%- elsif collection_titles contains 'Mattresses' -%}
                    {%- if card_product.available and in_stock == true -%}
                      {%- assign date_1 = 1 -%}
                      {%- assign date_2 = 7 -%}
                    {%- else -%}
                      {%- assign date_1 = 8 -%}
                      {%- assign date_2 = 14 -%}
                    {%- endif -%}
                  {%- elsif collection_titles contains 'Living Room'
                    or collection_titles contains 'Dining Room'
                    or collection_titles contains 'Wardrobes'
                    or collection_titles contains 'Chest of Drawers'
                    or collection_titles contains 'Bedside Tables'
                    or collection_titles contains 'Sideboards'
                  -%}
                    {%- assign date_1 = 7 -%}
                    {%- assign date_2 = 10 -%}
                  {%- endif -%}

                  {%- assign today_1 = 'now' | date: '%s' -%}
                  {%- assign today_2 = 'now' | date: '%s' -%}
                  {%- assign seconds_1 = date_1 | times: 24 | times: 60 | times: 60 -%}
                  {%- assign seconds_2 = date_2 | times: 24 | times: 60 | times: 60 -%}

                  {%- assign delivery_date_timestamp_1 = today_1 | plus: seconds_1 -%}
                  {%- assign delivery_date_timestamp_2 = today_2 | plus: seconds_2 -%}

                  {%- assign delivery_day_1 = delivery_date_timestamp_1 | date: '%e' -%}
                  {%- assign delivery_day_2 = delivery_date_timestamp_2 | date: '%e' -%}

                  {%- assign delivery_date_suffix_1 = '' -%}
                  {%- assign delivery_date_suffix_2 = '' -%}

                  {%- case delivery_day_1 | modulo: 10 -%}
                    {%- when 1 -%}
                      {%- assign delivery_date_suffix_1 = 'st' -%}
                    {%- when 2 -%}
                      {%- assign delivery_date_suffix_1 = 'nd' -%}
                    {%- when 3 -%}
                      {%- assign delivery_date_suffix_1 = 'rd' -%}
                    {%- else -%}
                      {%- assign delivery_date_suffix_1 = 'th' -%}
                  {%- endcase -%}

                  {%- case delivery_day_2 | modulo: 10 -%}
                    {%- when 1 -%}
                      {%- assign delivery_date_suffix_2 = 'st' -%}
                    {%- when 2 -%}
                      {%- assign delivery_date_suffix_2 = 'nd' -%}
                    {%- when 3 -%}
                      {%- assign delivery_date_suffix_2 = 'rd' -%}
                    {%- else -%}
                      {%- assign delivery_date_suffix_2 = 'th' -%}
                  {%- endcase -%}

                  {%- assign formatted_date_1 = delivery_date_timestamp_1
                    | date: '%b '
                    | append: delivery_day_1
                    | append: delivery_date_suffix_1
                  -%}
                  {%- assign formatted_date_2 = delivery_date_timestamp_2
                    | date: '%b '
                    | append: delivery_day_2
                    | append: delivery_date_suffix_2
                  -%}
                
                  <div class="d-inline-flex" style="font-size: 14px;">

                    {% comment %} <script>
                      console.log('Product: ', {{ card_product | json }});
                    </script> {% endcomment %}
                    
                    <svg 
                      class="icon icon-fast-truck" 
                      height="16" aria-hidden="true" 
                      focusable="false" 
                      role="presentation" 
                      fill="currentColor" 
                      stroke="currentColor" 
                      xmlns="http://www.w3.org/2000/svg" 
                      viewBox="0 0 640 512" 
                      style="margin-top: 2px;"
                    >
                      <path d="M280 192c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H40c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240zm352 192h-24V275.9c0-16.8-6.8-33.3-18.8-45.2l-83.9-83.9c-11.8-12-28.3-18.8-45.2-18.8H416V78.6c0-25.7-22.2-46.6-49.4-46.6H113.4C86.2 32 64 52.9 64 78.6V96H8c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H96V78.6c0-8.1 7.8-14.6 17.4-14.6h253.2c9.6 0 17.4 6.5 17.4 14.6V384H207.6C193 364.7 170 352 144 352c-18.1 0-34.6 6.2-48 16.4V288H64v144c0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16h195.2c-1.1 5.2-1.6 10.5-1.6 16 0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16H632c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm-488 96c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm272-320h44.1c8.4 0 16.7 3.4 22.6 9.4l83.9 83.9c.8.8 1.1 1.9 1.8 2.8H416V160zm80 320c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-96h-16.4C545 364.7 522 352 496 352s-49 12.7-63.6 32H416v-96h160v96zM256 248v-16c0-4.4-3.6-8-8-8H8c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8z"></path>
                    </svg>
                    {%- if section.settings.collection_delivery_eta_heading != blank -%}
                      <div class="ml-2">
                        {{ section.settings.collection_delivery_eta_heading | escape }}: 

                        {%- if section.settings.date_type == 'UAE' -%}
                          {%- if in_stock == true -%}
                            <strong class="pr-1 mr-1"> 1 - 7 days</strong>
                          {%- else -%}
                            {%- if card_product.vendor == "UAE" -%}
                              <strong class="pr-1 mr-1"> 2 - 4 weeks</strong>
                            {%- else -%}
                              <strong class="pr-1 mr-1"> 6 - 10 weeks</strong>
                            {%- endif -%}
                          {%- endif -%}
                        {%- elsif section.settings.date_type == 'accurate' -%}
                          <strong>{{ formatted_date_1 }}</strong> 
                          to 
                          <strong>{{ formatted_date_2 }}</strong>
                        {%- else -%}
                          {%- if in_stock == true -%}
                            <strong class="pr-1 mr-1"> Tomorrow</strong>
                          {%- else -%}
                            {%- if section.settings.tiers == 'on' -%}
                              {%- if card_product.metafields.Details.ProductTier == 1 -%}
                                <strong class="pr-1 mr-1"> 1 - 6 weeks</strong>
                              {%- elsif card_product.metafields.Details.ProductTier == 2 -%}
                                <strong class="pr-1 mr-1"> 6 - 12 weeks</strong>
                              {%- endif -%}
                            {%- else -%}
                              <strong class="pr-1 mr-1"> 2 weeks</strong>
                            {%- endif -%}
                          {%- endif -%}
                        {%- endif -%}

                      </div>
                    {%- endif -%}
                  </div>
                {%- endif -%}

                {%- if product_cards_style == 'advanced-default' or card_style_popup == 'advanced-default' -%}
                  {%- if show_quick_add or show_quick_add_mobile -%}
                    {%- liquid
                      assign product_form_id = 'quick-add-advanced-default-' | append: section_id | append: card_product.id
                      assign qty_rules = false
                      if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                        assign qty_rules = true
                      endif
                    -%}
                    <div class="card__function-item card__function-cart z-index-2">
                      {%- if card_product.variants.size > 1 or qty_rules -%}
                        <modal-opener data-modal="#QuickAdd-{{ card_product.id }}" class="d-block{% unless show_quick_add_mobile %} d-none-mw-xl{% endunless %}{% unless show_quick_add %} d-none-xl{% endunless %}">
                          <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                          <button
                            id="{{ product_form_id }}-submit"
                            type="submit"
                            name="add"
                            class="quick-add__submit button-advanced-default pos-relative c-pointer b-none bg-transparent c-gap p-0-i v-a-baseline d-flex a-i-end j-c-center typography-font-body"
                            aria-haspopup="dialog"
                            aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                            data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                            aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                            style="--c-gap: 0.6rem;"
                          >
                            <div class="block-text f-w-600">
                              {{ 'products.product.quick_add' | t }}
                            </div>
                            <div class="block-icon">
                              <span class="text d-flex a-i-center j-c-center w-100">
                                {% render 'icon-cart-card' %}
                              </span>
                              <div class="loading-overlay__spinner z-index-2 hidden">{{ icon_spinner }}</div>
                            </div>
                          </button>
                        </modal-opener>
                        <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                          <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                            <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                              <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                            </button>
                            <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                          </div>
                        </quick-add-modal>
                      {%- else -%}
                        <product-form class="d-block">
                          {%- form 'product',
                            card_product,
                            id: product_form_id,
                            class: 'form',
                            novalidate: 'novalidate',
                            data-type: 'add-to-cart-form'
                          -%}
                            <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                            <button
                              id="{{ product_form_id }}-submit"
                              type="submit"
                              name="add"
                              class="quick-add__submit button-advanced-default pos-relative c-pointer b-none bg-transparent c-gap p-0-i v-a-baseline d-flex a-i-end j-c-center typography-font-body"
                              aria-haspopup="dialog"
                              aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                              aria-live="polite"
                              data-sold-out-message="true"
                              aria-label="{{ 'templates.cart.cart_items' | t: count: 1 }}"
                              style="--c-gap: 0.6rem;"
                              {% if card_product.selected_or_first_available_variant.available == false %}
                                disabled
                              {% endif %}
                            >
                              <div class="block-text f-w-600">
                                {{ 'products.product.quick_add' | t }}
                              </div>
                              <div class="block-icon">
                                <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %} w-100">
                                  {% render 'icon-cart-card' %}
                                </span>
                                <span class="sold-out-message hidden">
                                  {{ 'products.product.sold_out' | t }}
                                </span>
                                <div class="loading-overlay__spinner z-index-2 hidden">{{ icon_spinner }}</div>
                              </div>
                            </button>
                          {%- endform -%}
                        </product-form>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- if product_cards_style == 'advanced-card' -%}
              </div>
            {%- endif -%}
            {%- if product_cards_style == 'standard' or product_cards_style == 'standard-plus' -%}
              {%- if show_swatch or show_swatch_mobile -%}
                {%- if card_product.has_only_default_variant == false -%}
                  {%- if show_swatch or show_swatch_mobile -%}
                    {%- liquid
                      assign swatch = settings.swatch | split: ',' | strip | downcase | handle
                    -%}
                    {%- for option in card_product.options_with_values -%}
                      {%- liquid
                        assign is_swatch = false
                        assign option_name = option.name | downcase
                        if swatch contains option_name
                          assign is_swatch = true
                          assign option_size = option.values | size
                          assign variants_option_one_arr = card_product.variants | map: 'option1'
                          assign variants_option_two_arr = card_product.variants | map: 'option2'
                          assign variants_option_three_arr = card_product.variants | map: 'option3'
                        endif
                      -%}
                      {%- if is_swatch -%}
                        <div class="card__swatch d-flex f-wrap a-i-center j-c-start{% unless show_swatch_mobile %} d-none-mw-xl{% endunless %}{% unless show_swatch %} d-none-xl{% endunless %}">
                          {%- liquid 
                            if product_cards_style == 'standard-plus'
                              assign swatch_limit = 5
                            else
                              assign swatch_limit = 4
                            endif
                          -%}
                          {%- for value in option.values -%}
                            {% unless forloop.index > swatch_limit %}
                              {%- liquid
                                assign variant_image = ''
                                for variant in card_product.variants
                                  case option.position
                                    when 1
                                      if variants_option_one_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 2
                                      if variants_option_two_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 3
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                  endcase
                                endfor
                              -%}
                              <span
                                class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                                title="{{ value }}" {% unless variant_image != blank and image_bg_url != '' %} style="--border-variant-color: {{ value | split: ' ' | last | handle }};"{% endunless %}
                              >
                                {%- if variant_image != blank -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  {%- liquid
                                    assign image_bg = value | handle | append: '.' | append: 'png'
                                    assign image_bg_url = ''
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    else
                                      assign image_bg = value | handle | append: '.' | append: 'jpg'
                                      if images[image_bg] != blank
                                        assign image_bg_url = image_bg | file_url
                                      endif
                                    endif
                                  -%}
                                  {%- if image_bg_url != '' %}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center"
                                      style="background-image: url({{ image_bg_url }})"
                                      role="none"
                                    ></span>
                                  {%- else -%}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                      style="background-color: {{ value | split: ' ' | last | handle }};"
                                      role="none"
                                    ></span>
                                  {%- endif -%}
                                {%- endif -%}
                              </span>
                            {%- endunless -%}
                          {%- endfor -%}
                          {%- if option_size > swatch_limit -%}
                            {%- assign count = option_size | minus: swatch_limit -%}
                            <span class="card__swatch--count color-light">
                              {%- if product_cards_style == 'standard' -%}
                                {{ 'products.product.more_variants' | t: count: count }}
                              {%- elsif product_cards_style == 'standard-plus' -%}
                                {{ 'products.product.count_variants' | t: count: count }}
                              {%- endif -%}
                            </span>
                          {%- endif -%}
                        </div>
                        {% break %}
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' -%}
            </div>
          {%- endif -%}

          {%- if product_cards_style == 'card' or product_cards_style == 'advanced-card' or product_cards_style == 'default' or product_cards_style == 'advanced-default' -%}
            {%- if show_swatch or show_swatch_mobile or show_quick_add or show_quick_add_mobile -%}
              {%- if card_product.has_only_default_variant == false -%}
                {%- if show_swatch or show_swatch_mobile -%}
                  {%- liquid
                    assign swatch = settings.swatch | split: ',' | strip | downcase | handle
                  -%}
                  {%- for option in card_product.options_with_values -%}
                    {%- liquid
                      assign is_swatch = false
                      assign option_name = option.name | downcase
                      if swatch contains option_name
                        assign is_swatch = true
                        assign option_size = option.values | size
                        assign variants_option_one_arr = card_product.variants | map: 'option1'
                        assign variants_option_two_arr = card_product.variants | map: 'option2'
                        assign variants_option_three_arr = card_product.variants | map: 'option3'
                      endif
                    -%}
                    {%- if is_swatch -%}
                      <div class="card__swatch d-flex f-wrap a-i-center{% if product_cards_style == 'default' %} j-c-center{% else %}{% if card_style_popup != 'advanced-default' %} b-full b-full-top{% endif %}{% endif %}{% unless show_swatch_mobile %} d-none-mw-xl{% endunless %}{% unless show_swatch %} d-none-xl{% endunless %}{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %} d-none-lg{% endif %}">
                        {%- if product_cards_style == 'default' or product_cards_style == 'card' or product_cards_style == 'advanced-card' -%}
                          {%- for value in option.values -%}
                            {% unless forloop.index > 4 %}
                              {%- liquid
                                assign variant_image = ''
                                for variant in card_product.variants
                                  case option.position
                                    when 1
                                      if variants_option_one_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 2
                                      if variants_option_two_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 3
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                  endcase
                                endfor
                              -%}
                              <span
                                class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                                title="{{ value }}" {% unless variant_image != blank and image_bg_url != '' %} style="--border-variant-color: {{ value | split: ' ' | last | handle }};"{% endunless %}
                              >
                                {%- if variant_image != blank -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  {%- liquid
                                    assign image_bg = value | handle | append: '.' | append: 'png'
                                    assign image_bg_url = ''
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    else
                                      assign image_bg = value | handle | append: '.' | append: 'jpg'
                                      if images[image_bg] != blank
                                        assign image_bg_url = image_bg | file_url
                                      endif
                                    endif
                                  -%}
                                  {%- if image_bg_url != '' %}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center"
                                      style="background-image: url({{ image_bg_url }})"
                                      role="none"
                                    ></span>
                                  {%- else -%}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                      style="background-color: {{ value | split: ' ' | last | handle }};"
                                      role="none"
                                    ></span>
                                  {%- endif -%}
                                {%- endif -%}
                              </span>
                            {%- endunless -%}
                          {%- endfor -%}
                          {%- if option_size > 4 -%}
                            {%- assign count = option_size | minus: 4 -%}
                            <span class="card__swatch--count color-light">
                              {{ 'products.product.more_variants' | t: count: count }}
                            </span>
                          {%- endif -%}
                        {%- elsif product_cards_style == 'advanced-default' -%}
                          {%- for value in option.values -%}
                            {% unless forloop.index > 5 %}
                              {%- liquid
                                assign variant_image = ''
                                for variant in card_product.variants
                                  case option.position
                                    when 1
                                      if variants_option_one_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 2
                                      if variants_option_two_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 3
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                    when 4
                                      if variants_option_three_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                        assign variant_image = card_product.variants[forloop.index0].image
                                        break
                                      endif
                                  endcase
                                endfor
                              -%}
                              <span
                                class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                                title="{{ value }}" {% unless variant_image != blank and image_bg_url != '' %} style="--border-variant-color: {{ value | split: ' ' | last | handle }};"{% endunless %}
                              >
                                {%- if variant_image != blank -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  {%- liquid
                                    assign image_bg = value | handle | append: '.' | append: 'png'
                                    assign image_bg_url = ''
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    else
                                      assign image_bg = value | handle | append: '.' | append: 'jpg'
                                      if images[image_bg] != blank
                                        assign image_bg_url = image_bg | file_url
                                      endif
                                    endif
                                  -%}
                                  {%- if image_bg_url != '' %}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center"
                                      style="background-image: url({{ image_bg_url }})"
                                      role="none"
                                    ></span>
                                  {%- else -%}
                                    <span
                                      class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                      style="background-color: {{ value | split: ' ' | last | handle }};"
                                      role="none"
                                    ></span>
                                  {%- endif -%}
                                {%- endif -%}
                              </span>
                            {%- endunless -%}
                          {%- endfor -%}
                          {%- if option_size > 5 -%}
                            {%- assign count = option_size | minus: 5 -%}
                            <span class="card__swatch--count color-light">
                              {{ 'products.product.more_variants' | t: count: count }}
                            </span>
                          {%- endif -%}
                        {%- endif -%}
                      </div>
                      {% break %}
                    {%- endif -%}
                  {%- endfor -%}
                {%- endif -%}
              {%- endif -%}
              {%- if product_cards_style == 'default' -%}
                {%- if show_quick_add or show_quick_add_mobile -%}
                  <div class="card__quickadd quick-add no-js-hidden">
                      {%- liquid
                        assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id
                        assign qty_rules = false
                        if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                          assign qty_rules = true
                        endif
                      -%}
                      {%- if card_product.variants.size > 1 or qty_rules -%}
                        <modal-opener data-modal="#QuickAdd-{{ card_product.id }}" class="d-block{% unless show_quick_add_mobile %} d-none-mw-xl{% endunless %}{% unless show_quick_add %} d-none-xl{% endunless %}">
                          <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                          <button
                            id="{{ product_form_id }}-submit"
                            type="submit"
                            name="add"
                            class="quick-add__submit button {{ settings.button_style | prepend: 'button--style-' }} {{ card_button_text_size | prepend: 'text-size-' }} {{ card_button_transform }} w-100 center{% if card_button_type == 'transparent' %} button--transparent{% endif %}"
                            aria-haspopup="dialog"
                            aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                            data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                          >
                            <span class="text">
                              {{ 'products.product.choose_options' | t }}
                            </span>
                            <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                          </button>
                        </modal-opener>
                        <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                          <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                            <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                              <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                            </button>
                            <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                          </div>
                        </quick-add-modal>
                      {%- else -%}
                        <product-form class="d-block">
                          {%- form 'product',
                            card_product,
                            id: product_form_id,
                            class: 'form',
                            novalidate: 'novalidate',
                            data-type: 'add-to-cart-form'
                          -%}
                            <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                            <button id="{{ product_form_id }}-submit" type="submit" name="add" class="quick-add__submit button {{ settings.button_style | prepend: 'button--style-' }} {{ card_button_text_size | prepend: 'text-size-' }} {{ card_button_transform }} w-100 j-c-center{% if card_button_type == 'transparent' %} button--transparent{% endif %}" aria-haspopup="dialog" aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}" aria-live="polite" data-sold-out-message="true"{% if card_product.selected_or_first_available_variant.available == false %} disabled{% endif %}>
                              <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %} j-c-center center w-100">
                                {%- if card_product.selected_or_first_available_variant.available -%}
                                  {{ 'products.product.add_to_cart' | t }}
                                {%- else -%}
                                  {{ 'products.product.sold_out' | t }}
                                {%- endif -%}
                              </span>
                              <span class="sold-out-message hidden">
                                {{ 'products.product.sold_out' | t }}
                              </span>
                              <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                            </button>
                          {%- endform -%}
                        </product-form>
                      {%- endif -%}
                  </div>
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        </div>
      </div>
    </{% if product_cards_style == 'card' or product_cards_style == 'advanced-card' %}animate-element{% else %}div{% endif %}>
  </div>
{%- else -%}
  <div class="product-card-wrapper card-wrapper pos-relative h-100">
    <div class="card d-flex f-column h-100">
      <div class="card__inner pos-relative o-h w-100 gradient gradient-global">

        <div 
          style="
            position: absolute;
            background-color: red;
            z-index: 5;
            height: 75px;
            width: 75px;
            top: 0;
            right: 0;
          "
        >
        </div>

        <div class="card__media o-h">
          <div class="media media--transparent pos-relative o-h d-block" style="padding-bottom: 100%;">
            {%- liquid
              assign index = index | default: 1
              if index > 6
                assign index = index | modulo: 6 | plus: 1
              endif
            -%}
            {{ 'product-' | append: index | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        </div>
      </div>
      <div class="card__content d-grid w-100">
        <div class="card__information">
          {%- if show_vendor -%}
            <div class="card__vendor subrte f-bold">
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              {{ 'products.product.vendor' | t }}
            </div>
          {%- endif -%}
          <h3 class="card__heading m-0">
            <a role="link" aria-disabled="true" class="d-block u-none color-current link-cover">
              {{- 'onboarding.product_title' | t -}}
            </a>
          </h3>
          <div class="card__price">
            {% render 'price', main_price: true, price_class: ' left ' %}
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}

{% style %}

{% endstyle %}